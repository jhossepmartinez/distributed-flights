syntax = "proto3";

package flight;

option go_package = "./proto";

service Coordinator {
  rpc ClientWrite(ClientWriteRequest) returns (WriteResponse);
  rpc ClientRead(ClientReadRequest) returns (ReadResponse);
}

service DataNodeService {
  rpc Gossip(GossipRequest) returns (GossipResponse);
  rpc Write(WriteRequest) returns (WriteResponse);
  rpc Read(ReadRequest) returns (ReadResponse);
}

message ClientWriteRequest {
  string client_id = 1;
  string flight_id = 2;
  string update_type = 3;
  string value = 4;
}

message ClientReadRequest {
  string client_id = 1;
  string flight_id = 2;
}

message WriteRequest {
  string flight_id = 1;
  string update_type = 2;
  string value = 3;
}

message WriteResponse {
  bool success = 1;
  string node_id = 2;
  VectorClock clock = 3;
}

message ReadRequest {
  string flight_id = 1;
}

message ReadResponse {
  FlightState state = 1;
}

message VectorClock {
  map<string, int32> versions = 1;
}

message FlightState {
  string status = 1;
  string gate = 2;
  VectorClock clock = 3;
}

message GossipRequest {
  string flight_id = 1;
  FlightState state = 2;
  string sender_id = 3;
}

message GossipResponse {
  bool success = 1;
}
