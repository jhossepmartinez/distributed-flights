syntax = "proto3";

package flight;

option go_package = "./proto";

service TrafficService {
  rpc RequestVote(VoteRequest) returns (VoteResponse);
  rpc AppendEntries(AppendEntriesRequest) returns (AppendEntriesResponse);
  rpc RequestLanding(LandingRequest) returns (LandingResponse);
}

service Coordinator {
  rpc ClientWrite(ClientWriteRequest) returns (WriteResponse);
  rpc ClientRead(ClientReadRequest) returns (ReadResponse);
}

service DataNodeService {
  rpc Gossip(GossipRequest) returns (GossipResponse);
  rpc Write(WriteRequest) returns (WriteResponse);
  rpc Read(ReadRequest) returns (ReadResponse);
}

message VoteRequest {
  int32 term = 1;
  string candidate_id = 2;
  int32 last_log_index = 3;
  int32 last_log_term = 4;
}

message VoteResponse {
  int32 term = 1;
  bool vote_granted = 2;
}

message LogEntry {
  int32 term = 1;
  string command = 2; // Ej: "ASIGNAR PISTA 1 A VUELO LA-500"
}

message AppendEntriesRequest {
  int32 term = 1;
  string leader_id = 2;
  int32 prev_log_index = 3;
  int32 prev_log_term = 4;
  repeated LogEntry entries = 5;
  int32 leader_commit = 6;
}

message AppendEntriesResponse {
  int32 term = 1;
  bool success = 2;
}

// Mensajes Cliente (Broker)
message LandingRequest {
  string flight_id = 1;
}

message LandingResponse {
  bool success = 1;
  string message = 2; // "Asignada", "Ocupada", o "No soy lider"
  string leader_hint = 3; // ID del l√≠der actual si se conoce
  string assigned_runway_id = 4;
}

message ClientWriteRequest {
  string client_id = 1;
  string flight_id = 2;
  string update_type = 3;
  string value = 4;
}

message ClientReadRequest {
  string client_id = 1;
  string flight_id = 2;
  VectorClock known_versions = 3;
}

message WriteRequest {
  string flight_id = 1;
  string update_type = 2;
  string value = 3;
}

message WriteResponse {
  bool success = 1;
  string node_id = 2;
  VectorClock clock = 3;
}

message ReadRequest {
  string flight_id = 1;
  VectorClock known_versions = 2;
}

message ReadResponse {
  FlightState state = 1;
}

message VectorClock {
  map<string, int32> versions = 1;
}

message FlightState {
  string status = 1;
  string gate = 2;
  map<string, string> seat_map = 3;
  VectorClock clock = 4;
}

message GossipRequest {
  string flight_id = 1;
  FlightState state = 2;
  string sender_id = 3;
}

message GossipResponse {
  bool success = 1;
}
